%-------------------------------------------------------------------------------
% cookbook_instruments
%-------------------------------------------------------------------------------
%
% \file        cookbook_instruments.tex
% \library     Documents
% \author      Chris Ahlstrom
% \date        2015-07-12
% \update      2016-02-28
% \version     $Revision$
% \license     $XPC_GPL_LICENSE$
%
%     Provides the cookbooks_instruments section of yoshimi-cookbook.tex.
%
%-------------------------------------------------------------------------------

\section{Creating Instruments}
\label{sec:cookbook_instruments}

   One of our goals in using \textsl{Yoshimi} is to support
   \textsl{General MIDI} (\textsl{GM})
   to the greatest extent possible.

   However, no banks have been created with GM in mind.  And many of the
   instruments, though given names that indicate what they are intended to
   be, fall well short of being recognizable per their name; they should be
   doable with a complex synthesizer like \textsl{Yoshimi}.
  
   It is true that there are a vast number of \textsl{Yoshimi} and
   \textbf{ZynAddSubFX} patches/parts/instruments out there.  The author
   had attempted a survey of them, and the task was all but impossible.
   Still, many candidates have been identified.  Other candidates might be
   suitable with a little tweaking.

   Here are a number of categories of instruments for which we want to
   assemble an improved set of instruments:

   \begin{enumber}
      \item \textbf{Bells}
      \item \textbf{Ethnic}
      \item \textbf{Drums}
      \item \textbf{Effects}
      \item \textbf{Piano}
      \item \textbf{Leads}
      \item \textbf{Guitar}
      \item \textbf{Strings} (individual and ensemble)
      \item \textbf{Bass}
      \item \textbf{Saxophones}
   \end{enumber}

   These recipes will be found in this cookbook project;
   the \texttt{banks} directories are found
   in the following directories:
   \index{directories!demo bank}

   \begin{verbatim}
      yoshimi/banks
      yoshimi/banks/demo
   \end{verbatim}

\subsection{Bells}
\label{subsec:cookbook_instruments_bells}

   The bells patches we've heard so far are nice, but a bit anemic.
   
   \index{ring modulation}
   Good bell patches are easier with ring modulation, done right.  We're not
   sure if there are any such patches extant; please send them to us if
   have some in hand.

   \index{bells}
   In the meantime, creating bells is a good excuse to master
   \textsl{Yoshimi}'s ring modulator.
   However, we will first learn how to create a reasonable, clangy bell
   using just a few voices in an ADDsynth part, and no need for modulation.

\subsubsection{Bells by Voices}
\label{subsec:cookbook_instruments_bells_by_voices}

   The following table comes from a tutorial (\cite{bellsimple}).  Along
   with a spectrum shown in reference \cite{bellspectrum}, it allows us to
   recreate a simple, but realistic bell.
   \index{bells!spectrum}
   In this table, \texttt{F} represents the fundamental frequency, i.e. the
   note being played.

\label{table:simple_bell_tones}
\begin{longtable}{c c c c}
   \caption{Simple Bell Tones} \\
   \hline
      \textbf{Wave Number} &
      \textbf{Frequency} &
      \textbf{Cents Offset} &
      \textbf{Relative Amplitude} \\
   \hline
   \endfirsthead

   1 &  0.56F &  -1000 &   0.5   \\
   2 &  0.92F &  -140  &   1.0   \\
   3 &  1.19F &  +300  &   0.5   \\
   4 &  1.71F &  +930  &   0.25  \\
   5 &  2.00F &  +1200 &   0.125 \\
   6 &  2.74F &  +1745 &   0.125 \\
   7 &  3.00F &  +1901 &   0.125 \\
   8 &  3.76F &  +2290 &   0.125 \\
   9 &  4.00F &  +2400 &         \\
\end{longtable}

   Note that the frequencies are relative to the fundamental frequency (F).
   Also note that wave 2 (close to F) can be missing, and the sound still is
   bell-like.

   \index{files!bells addsynth}
   The file \texttt{yoshimi/banks/demo/Bells-simple-addsynth.xiz} is the
   result of following the steps below.  We start, as usual, with a
   newly-started \textsl{Yoshimi} instance.

   \begin{enumber}
      \item Open the ADDsynth editing window by clicking the \textbf{Edit}
         button in the bottom panel, and then clicking the ADDsynth
         \textbf{Edit} button in the edit window.
      \item Click on the \textbf{Show Voice Parameters} button.
         Note that it is \textbf{Current Voice 1}, and it should be enabled.
      \item For voice 1, make the following settings:
         \begin{enumber}
            \item \textbf{Octave}: Set to 0.
            \item \textbf{Detune Type}: Set to E1200cents.
            \item \textbf{FREQUENCY Detune}: Set to -1000 approximately.
         \end{enumber}
      \item Go to voice 2, and make the following settings:
         \begin{enumber}
            \item \textbf{Octave}: Set to 0.
            \item \textbf{Detune Type}: Set to E1200cents.
            \item \textbf{FREQUENCY Detune}: Set to -140 approximately.
         \end{enumber}
      \item Go to voice 3, and make the following settings:
         \begin{enumber}
            \item \textbf{Octave}: Set to 0.
            \item \textbf{Detune Type}: Set to E1200cents.
            \item \textbf{FREQUENCY Detune}: Set to 300 approximately.
         \end{enumber}
      \item Go to voice 4, and make the following settings:
         \begin{enumber}
            \item \textbf{Octave}: Set to 0.
            \item \textbf{Detune Type}: Set to E1200cents.
            \item \textbf{FREQUENCY Detune}: Set to 930 approximately.
         \end{enumber}
      \item Go to voice 5, and make the following settings:
         \begin{enumber}
            \item \textbf{Octave}: Set to 1.
            \item \textbf{Detune Type}: Set to Default.
            \item \textbf{FREQUENCY Detune}: Set to 0.
         \end{enumber}
      \item Go to voice 6, and make the following settings:
         \begin{enumber}
            \item \textbf{Octave}: Set to 1.
            \item \textbf{Detune Type}: Set to E1200cents.
            \item \textbf{FREQUENCY Detune}: Set to 545 approximately.
         \end{enumber}
      \item Go to voice 7, and make the following settings:
         \begin{enumber}
            \item \textbf{Octave}: Set to 1.
            \item \textbf{Detune Type}: Set to E1200cents.
            \item \textbf{FREQUENCY Detune}: Set to 700 approximately.
         \end{enumber}
      \item Go to voice 8, and make the following settings:
         \begin{enumber}
            \item \textbf{Octave}: Set to 1.
            \item \textbf{Detune Type}: Set to E1200cents.
            \item \textbf{FREQUENCY Detune}: Set to 1090 approximately.
         \end{enumber}
   \end{enumber}

   These settings then end up roughly matching the settings of the first 8
   waves in \tableref{table:simple_bell_tones}.
   \index{bells}
   This instrument isn't perfect.  It's not quite equally tempered, though
   close.  The character of the tone changes a bit as the notes get higher.
   One can fiddle with the relative amplitudes of the various voices to
   change the character of this sound.

\subsubsection{Ring Modulation with 440 Hz Tone}
\label{subsec:cookbook_instruments_ring_mod_440}

   Now for an initial demonstration of ring modulation.
   This demonstration does not quite create a bell tone, but does show
   the sound of modulation.

   Start with a fresh \textsl{Yoshimi} and a cleared instrument ("Simple
   Sound").  Open the virtual keyboard using the \textbf{virKbd} button.
   Click a key and verify that you can hear a tone.
   \index{"C" note}
   \index{comma key}
   We'll use the middle C
   key (the "comma" on the PC keyboard) as a reference.  We will call it
   the "C" note.

   The following steps will set up two tones, voice 1 and voice 2, and voice
   2 will use voice 1 as an external modulator.
   Note that you can accomplish most of these steps by loading the project
   file
   \index{bells}
   \index{files!bells 440}
   \texttt{yoshimi/banks/demo/Bells-440-ring-modulation.xiz}, but use
   that only as a last resort.

   \begin{enumber}
      \item Open the ADDsynth editing window by clicking the \textbf{Edit} button
         in the bottom panel, and then clicking the ADDsynth \textbf{Edit}
         button in the edit window.
      \item In the \textbf{Amplitude Env} sub-panel, increase the
         \textbf{D.dt} and \textbf{R.dt} to give the current
         sound a nice slow decay.
      \item Click on the \textbf{Show Voice Parameters} button.
         Note that it is \textbf{Current Voice 1}, and it should be enabled.
      \item Switch to \textbf{Current Voice} number 2 and enable it.
         Play the "C" note, and observe that it is the same frequency, but
         louder.
      \item Move the \textbf{FREQUENCY Detune} slider a bit, and play the "C"
         note.  It should sound the same as before, but change slowly in
         amplitude, as heard and as seen on the \textbf{VU meter}.
         Try to set the detune back to 0; this is easier if you highlight
         the tuning knob and use the left or right arrow keys.
      \item In the \textbf{MODULATOR} section of voice 2, for \textbf{Type},
         select the \textbf{RING} value.  (However, feel free to select one
         of the other modulators, to experiment, once you've mastered
         the ring modulator.)  Press the "C" key again, and notice
         that the tone character changes a bit.  This is due to the internal
         modulator.
      \item For \textbf{External Mod.} for voice 2, select
         \textbf{Ext.M} 1, to use the voice 1 as the internal modulator.
         The "C" note may change in character, but only slightly.
         Apparently the default internal modulator is the same as the
         default external voice 1 waveform.
      \item To actually hear some modulation, we have to separate the
         frequencies of voice 1 and voice 2.  Click the \textbf{440Hz}
         check-box in the \textbf{FREQUENCY} section of voice 1.  Press the
         "C" key and verify hearing a two-tone signal, somewhat like a phone
         tone.
      \item Now go back to voice 2 and click the \textbf{Change} button to
         bring up the ADDsynth oscillator dialog.
      \item Move the slider to maximum for harmonic 10.  Press the "C" key
         and verify the new sound (a bit like a car horn).
         Set the sliders back to 0, and "C" will be a single tone again.
      \item Change the \textbf{Octave} values of voice 2 in its
         \textbf{FREQUENCY} section and listen to the effects.
   \end{enumber}

   Now we need to see if we can apply modulation across instruments.
   Sadly, this does not seem to be possible.

   Increase the \textbf{D.dt} and \textbf{R.dt} values of the main
   \textbf{Amplitude Env} to give this sound the onset and decay of a bell,
   and it then sounds less abstract, and more like a bell.
   Of course, this kind of bell is even less tunable than the simple
   bell of the previous section.

   Another thing to try with this setup is to simply change voice 2 to use
   different types of modulators besides \textbf{RING}.
   \textbf{MORPH} sounds basically identical to \textbf{RING}.
   \textbf{PM} seems to expose higher harmonics, making the sound louder and
   brighter.
   \textbf{FM} sounds similar to PM, but softer and smoother.
   \textbf{PITCH} is disabled.

   Another experiment is to disable the modulator (voice 1 here) and see how
   that changes the sound; all it should do is drop voice 1 from the
   spectrum -- voice 1 will still be used as the modulator.

   Finally, by adding a slow decay to this sound, it becomes amazingly more
   bell-like.

\subsubsection{Complex Bells by Ring Modulation}
\label{subsec:cookbook_instruments_bells_by_ring_mod}

   The next step is to make the bells more complex, by combining the methods
   of the previous two sections.
   Recall \tableref{table:simple_bell_tones}.
   It shows the 9 frequencies in the simple bell spectrum, though we could
   define only 8 of them.  How can we best add extra frequencies?
   \index{bells}
   We can ring-modulate the higher frequencies against one of the lower
   frequencies.

\label{table:ring_mod_bell_tones}
\begin{longtable}{l l l l l}
   \caption{Ring Modulation Bell Tones} \\
   \hline
      \textbf{Wave Number} &
      \textbf{Frequency} &
      \textbf{Mod Frequency} &
      \textbf{f2-f1} &
      \textbf{f2+f1} \\
   \hline
   \endfirsthead

   1 &  0.56F &  ----- &  -----   &  -----   \\
   2 &  0.92F &  0.56F &  0.36F   &  1.48F   \\
   3 &  1.19F &  0.56F &  0.63F*  &  1.75F*  \\
   4 &  1.71F &  0.56F &  1.15F*  &  2.27F   \\
   5 &  2.00F &  0.56F &  1.44F   &  2.56F   \\
   6 &  2.74F &  0.56F &  2.18F   &  3.30F   \\
   7 &  3.00F &  0.56F &  2.44F   &  3.56F   \\
   8 &  3.76F &  0.56F &  3.20F   &  4.32F   \\
\end{longtable}

   The asterisk marks frequencies that are close to existing
   frequencies.   Luckily, there are only three of them, so our
   modulation should add a good number of frequencies.

   \index{files!bells addsynth}
   \begin{enumber}
      \item Load the file \texttt{yoshimi/banks/demo/Bells-simple-addsynth.xiz}
         to save a lot of steps.  The next steps add voice 1 as a ring
         modulator for voices 2 through 8.
      \item Open the ADDsynth editing window by clicking the \textbf{Edit}
         button in the bottom panel, and then clicking the ADDsynth
         \textbf{Edit} button in the edit window.
      \item Click on the \textbf{Show Voice Parameters} button.
         Note that it is \textbf{Current Voice 1}, and it should be enabled.
      \item Go to voice 2 and do the following steps:
         \begin{enumber}
            \item In the \textbf{MODULATOR} section (greyed out), change the
               \textbf{Type} from \textbf{OFF} to \textbf{RING}.
            \item Changes the \textbf{External Mod.} dropdown from
               \textbf{Off} to \textbf{ExtMod. 1}.
         \end{enumber}
      \item Go to voice 3 and repeat those steps.  Note how all the voices
         below the current voice become available as modulators.
   \end{enumber}

   We saved the result in the file
   \index{files!bells ring mod}
   \texttt{yoshimi/banks/demo/Bells-ringmod-addsynth.xiz} for safe-keeping.

   QUESTION:  If one loads and instrument and tinkers with it, but do not
   save it, does \textsl{Yoshimi} save it on exit anyway?

\subsection{Ethnic}
\label{subsec:cookbook_instruments_ethnic}

   We found a simple steel drum instrument, but think we might do better,
   creating one using ADDsynth and one using PADsynth.

   Instruments we have not found, and would like to synthesize, are:
   bagpipes and arabic pipes.

\subsubsection{Ethnic / Steel Drums}
\label{subsubsec:cookbook_instruments_ethnic_steeldrums}

   \index{steel drums}
   There is a steel-drum instrument that ships with \textsl{Yoshimi}:
   \index{files!steel drums}

   \texttt{/usr/share/yoshimi/banks/The\_Mysterious\_Bank/0122-pseudo\_steeldrums.xiz}.

   It is an ADDsynth module comprised of three voices:

   \begin{enumber}
      \item A \textbf{Unison}-enabled voice of \textbf{Size} = 10 and a
         \textbf{Frequency Spread} of 44.6 cents.
      \item Another voice that is exactly the same as the first, except that
         it has its \textbf{Amplitude Env} sub-panel enabled, to add more
         volume and character to the instrument, it is stronger on the
         right, and, most importantly, an octave higher.
      \item Another voice that is exactly the same as the second, 
         except it is an octave lower than voice 0.
   \end{enumber}

   If voice 2 and 3 are disabled, the instrument still sounds reminiscent of
   steel drums, so obviously the overall amplitude envelope is important.

   Can we do better?  Well, the instrument above sounds too pristine.
   We should be able to add some "dirt" to the instrument to make it sound
   more lively.

\begin{figure}[H]
   \centering 
   \includegraphics[scale=0.85]{contrib/steel_drum_spectrum.png}
   \caption{Typical Steel Drum Spectrum}
   \label{fig:cookbook_bank_steeldrum_spectrum}
\end{figure}

   Taking a cue from this figure, our steel drums extend the original
   by adding a couple more tones at octave intervals.  Also, some slight
   detuning was introduced to add to the flavor.
   We could probably add a couple more, and carefully contour their
   amplitude levels to match the spectrum levels shown above.

   To hear the ADDsynth steel drum sound, load the file
   \index{files!steel drums}
   \texttt{yoshimi/banks/demo/Add\_Pseudo\_Steel\_Drums.xiz}.

   Not content with that, with our hands behind our back, we pull
   SUBsynth from a hat.  The SUBsynth settings for a steel drum are shown in
   the following figure:

\begin{figure}[H]
   \centering 
   \includegraphics[scale=0.75]{demo/steeldrums-subsynth-editor.png}
   \caption{Steel Drum SUBsynth Configuration}
   \label{fig:cookbook_bank_steeldrum_subsynth}
\end{figure}

   Note the top box of slider controls.  It sets the amplitudes of
   the harmonics, and should vaguely resemble the spectrum diagram.
   The lower box of slider controls sets the bandwidth of each harmonic,
   with the fundamental frequency being very narrow.

   To hear the SUBsynth steel drum sound, load the file
   \index{files!steel drums}
   \texttt{yoshimi/banks/demo/Sub\_Pseudo\_Steel\_Drums.xiz}.
   It's pretty nasty.

   However, the best steel drum patch we've encountered so far is the
   \texttt{banks/olivers-100/0029-Steel Drums.xiz} from the installed banks
   of \textsl{ZynAddSubFx}, and that's the one we now copy to
   our cookbook project's 
   \texttt{yoshimi/banks/gm-basic/0115-Steel Drums.xiz} GM slot.

\subsection{Drums}
\label{subsec:cookbook_instruments_drums}

   We want a decent drum kit that attempts to fill in the gaps for a
   GM-compliant drum kit with solid sounds, with
   the help of an existing kit.

   It turns out that a "Natural Drum Kit", which we'd found separately on
   the Internet (from Dario Straulino) a long time ago, is now part of the
   instruments installed with \textsl{Yoshimi}.
   \index{drum kit}
   \index{GM!drum kit}
   But long ago we used some of the sounds
   from various kits to create our own "natural drum kit", and extended some
   of the sounds across more (pitched) keys so that any MIDI drum note would
   produce \textsl{some} sound.  We also made sure the sounds were laid out
   in GM format as much as possible.

   Fire up \textsl{Yoshimi} and load the instrument stored in
   \index{files!natural drums}
   \texttt{yoshimi/banks/demo/Natural\_Drum\_Kit\_Basic.xiz}, and we'll walk
   through it.  Click the \textbf{Edit} button in the bottom panel, and then
   click the \textbf{Kit Edit} button.

\begin{figure}[H]
   \centering 
   \includegraphics[scale=0.85]{demo/natural_drum_kit_from_ds_2.png}
   \caption{Natural Drum Kit from DS 2}
   \label{fig:cookbook_bank_natural_drum_kit}
\end{figure}

   \textbf{Item 1} is the master control for the whole kit, determining the
   range of keys that it covers and the effect (if any) it goes through.

   \textbf{Item 2} and \textbf{Item 3} provide the two parts of the
   "natural" snare drum.  Both parts are composed of an ADDsynth and a
   SUBsynth section, and they provide 3 pitches of snare.

   \index{natural drum!snare}
   One distinguishing feature of the "Snare - Stick + Snares" item
   is it's only ADDsynth voice.  Clickthe ADDsynth \textbf{Edit} button for
   item 2 in the kit editor.  Then Click on the
   \textbf{Show Voice Parameters} button.
   Note that the \textbf{Amplitude Env} sub-panel is enabled, and uses a
   Freemode envelope.  The voice is locked on \textbf{440Hz}, but detuned to
   be a lot lower than that.  The \textbf{Voice Oscillator}
   (click on the \textbf{Change} button) uses a
   \index{power function}
   \textbf{Base F.} (function)
   set to \textbf{Power}
   \index{pulse}
   to generate a spike pulse.
   There doesn't seem to be a way to temporarily mute an item, so we cannot
   hear what this item would sound like on its own.

   The SUBsynth part of the "Snare - Stick + Snares" item provide an
   \textbf{Amplitude Env}, \textbf{Bandwidth Envelope}, and a rich set of
   alternate harmonics of very narrow bandwidth.

   The "Snare-Head+Resonance" item's ADDsynth settings 
   provide Freemode \textbf{Amplitude Env} and \textbf{Frequency Envelope}
   settings with the voice locked on \textbf{440Hz}, but detuned to
   be a lot lower than that.  The \textbf{Voice Oscillator} is a sine wave.
   Voice 2 is set to \textbf{NOISE}, but is disabled.  Something to try out?
   Indeed, we changed voice 2 to a sine wave, moved it up an octave,
   and now the the Snare keys have slightly different qualities, a barely
   noticeable pitch.  A keeper!

   The "Snare-Head+Resonance" item's SUBsynth settings are a set of
   harmonics with a \textbf{Bandwidth Env}.

   \index{natural drum!hihats}
   \textbf{Item 4} is the "HiHat closed 2" instrument, a SUBsynth-only item.
   It provides an \textbf{Amplitude Env}, a \textbf{Bandwidth Env},
   and a \textbf{Frequency Env} centered around 440 Hz, offset downward 2
   octaves.  A number of harmonics are provided, obviously taken from some
   spectral diagram of a cymbal.

   \textbf{Item 5} is the "HiHat closed long 1" instrument, a SUBsynth-only
   item.  It is the same as the "HiHat closed 2" instrument, but with a
   longer amplitude envelope.

   \textbf{Item 6} is the "HiHat open 1" instrument, a SUBsynth-only item.
   Much like the other hi-hats, but with a Freemode
   \textbf{Bandwidth Envelope}.

   \index{natural drum!cymbal}
   \textbf{Item 7} provides the "Crash Cymbal 3" item.
   It is composed of an ADDsynth and a SUBsynth section.
   The ADDsynth provides a \textbf{Voice Oscillator} that, like
   \textbf{Item1}, uses a \index{power function}
   \textbf{Base F.} (function)
   set to \textbf{Power}
   \index{pulse}
   to generate a spike pulse.

   The SUBsynth section is similar to that of the
   "Snare-Head+Resonance" (\textbf{Item 3}), a set of
   harmonics with a \textbf{Bandwidth Env}.

   \index{natural drum!side stick}
   \textbf{Item 8} is the "Side Stick" instrument, an ADDsynth-only item.
   It's only voice, voice 1, is filtered white noise.
   One can increase the \textbf{Q} value of the filter to make it a bit
   metallic.  One can lower the \textbf{C.freq} value to make it sound like
   a bigger stick.

   \index{natural drum!pitched toms}
   \textbf{Item 9} is the "Tom".  It is just a tone with an AR frequency
   envelope.  The puzzling thing is that it is locked to 440 Hz plus 2
   octaves, but it can run the full length of keys 50 to 81 (so we can get
   "Extra toms") and gradually rise in pitch.  How?  Unlocking voice 1 seems
   to change nothing!

   \index{natural drum!bass drums}
   \textbf{Item 10} is "Bass Drum 2", a SUBsynth patch.
   Like the SUBsynth part of the "Snare - Stick + Snares" item, it provides
   a Freemode \textbf{Amplitude Env} and \textbf{Bandwidth Envelope}, but
   only a small set of low harmonics, and a -3 \textbf{Octave} offset, one
   octave lower than the snare.

   \textbf{Item 11} is "Acoustic Bass Drum".  It merely adds some more
   harmonics to the "Bass Drum 2" patch.

   \index{natural drum!toms}
   \textbf{Item 12} is the "Low Floor Tom", an ADDsynth patch.
   Voice 1, like \textbf{Item 9}, is a pitched tone with a frequency
   envelope.  Voice 2 is added to provide a noisy component.

   \textbf{Item 13} through \textbf{16} are also noisy toms.
   At some point, we'll try to use the XML files to determine how their
   pitches are determined.  To difficult to compare the two GUIs without
   taking screen shots.

   Okay, so this drum kit is a little tom-heavy!

   Now, without defining more than one drum kit, we have only about 15
   "drums" available to us in \textsl{Yoshimi}.  So we filled in the missing
   drums with more "toms", just so some sound will be made.  The frequencies
   of the upper toms get pretty crazy!  Here's a diagram of the keyboard
   layout.  Correlate it with
   \figureref{fig:cookbook_bank_natural_drum_kit}, to understand the
   abbreviations.

\begin{figure}[H]
   \centering 
   \includegraphics[scale=0.75]{demo/natural_drum_keyboard_layout.png}
   \caption{Natural Drum Kit Keyboard Layout}
   \label{fig:cookbook_bank_natural_drum_kit_layout}
\end{figure}

   For your reference, here is the full GM drum layout.  The diagram is
   taken from WikiMedia.org.

\begin{figure}[H]
   \centering 
   \includegraphics[scale=0.75]{demo/GMStandardDrumMap.png}
   \caption{General MIDI Drum Kit Keyboard Layout}
   \label{fig:cookbook_bank_general_drum_kit_layout}
\end{figure}

\subsection{Chromatic Percussion}
\label{subsec:cookbook_instruments_chromperc}

   One of the big blanks in the gm-basic sound set are the various
   stand-alone percussion instruments:
   woodblock, taiko drum, melodic tom, synth drum, and reverse cymbal.
   These occupy GM slots 116 through 120.

   One easy way to obtain these instruments is to find them in an existing
   drum kit, and extract each into its own instrument file.  Here is how we
   did it to obtain instrument 118, the Melodic Tom.

   First, set up a presets directory to hold any presets one creates, and
   make it the default presets directory.  For example, one can
   set this project's \texttt{yoshimi/presets} directory as the default
   location for preset files.

      \begin{enumber}
         \item Navigate to \textbf{Menu / Settings... / Preset Dirs}
            (a tab in the settings dialog).
         \item Click the \textbf{Add preset directory} button.
         \item Navigate to the desired directory, select it, click
            \textbf{OK}.
         \item Select the new preset directory, then click the
            \textbf{Make default} button.
         \item Press the \textbf{Save and Close} button.
         \item Restart \textsl{Yoshimi}.
      \end{enumber}

   Next, extract the Tom drum from the Natural Drum Kit for use as Melodic
   Tom GM patch:

      \begin{enumber}
         \item Load the "Natural Drum Kit" instrument.
         \item Click \textbf{Edit} to bring up the overall editor dialog.
         \item Then click the \textbf{Kit Edit} button.
         \item Move to item 9, "Tom", and click the
            \textbf{Edit} button to access its ADDsynth settings (the Global
            dialog).
         \item Press the blue \textbf{C} button in the ADDsynth Global
            dialog.
         \item Next to the grayed-out \textbf{Copy to Preset}
            button, give the setting (to be saved) a name:
            "Nat Drum ADDsynth Tom Part".  See the figure below.
         \item Press the now active \textbf{Copy to Preset} button.
         \item Depending on what dialog one is in when pressing the
            \textbf{C} button, the file will be save in the default preset
            \index{files!.ADnoteParameters.xpz}
            directory under a name like \texttt{.ADnoteParameters.xpz}.
      \end{enumber}

\begin{figure}[H]
   \centering 
   \includegraphics[scale=0.85]{demo/copy_to_clipboard.png}
   \caption{Copy to Clipboard Preset}
   \label{fig:cookbook_instruments_copy_to_clipboard}
\end{figure}

   \index{files!.ADnoteParameters.xpz}
   One should then copy the \textbf{.ADnoteParameters.xpz} file to a file
   with the name \textbf{Nat Drum ADDsynth Tom Part} (matching the name of
   the preset it holds), and restart Yoshimi.
   However, it is only accessible with the hidden file name in the
   \textbf{Paste From Clipboard} dialog, as far as we can tell.

   Finally, the preset can then be loaded into a new instrument as follows:

      \begin{enumber}
         \item Navigate to \textbf{Menu / Instrument / Clear Instrument}, and
            click \textbf{Yes} at the prompt.
         \item Navigate to the desired settings dialog.  In this case, it
            will involve clicking \textbf{Edit}, then the ADDsynth
            \textbf{Edit} button.
         \item In the \textbf{ADDsynth Global} dialog,
            press the blue \textbf{P} button in that dialog,
            to open the \textbf{Paste From Clipboard} dialog.
         \item Select the desired preset (that matches the current settings
            dialog).  In this case, it will be
            \index{files!.ADnoteParameters.xpz}
            \textbf{.ADnoteParameters.xpz}.
         \item Press the \textbf{Paste from Preset} button.
         \item Open the virtual keyboard using the \textbf{virKbd} button,
            and verify that the instrument sounds like the proper Tom kit
            item.
         \item Go back to the Main edit dialog and change the \textbf{Type}
            to the best matching value; here, it would be
            \textbf{Chromatic Percussion}.  Then fill in the
            \textbf{Author and Copyright} and \textbf{Comments} fields.
         \item In the main \textsl{Yoshimi} window, right-click on the part
            name.  In the prompt for \textbf{Instrument name}, type the name
            of the instrument/part; in this case, "Melodic Tom".
         \item Navigate to
            \textbf{Menu / Instrument / Save instrument...}.
            Navigate to the desired directory, append the name (e.g.
            "Melodic Tom.xiz"), and save it.
      \end{enumber}

   It is wise to restart \textsl{Yoshimi} and verify that the new instrument
   can be loaded and played.

\subsection{Effects}
\label{subsec:cookbook_instruments_effects}

   This section documents the various "effects" instruments we've created.

\subsubsection{Effects / Dial Tones}
\label{subsubsec:cookbook_instruments_effects_dialtones}

   \index{effects!dial tone}
   We've created a nice dial-tone effect that we'll describe here.
   Dial tones consist of two notes, as shown by the
   \textbf{Low F} and \textbf{High F} columns in the following table.

\label{table:effect_dial_tones}
\begin{longtable}{l l l l l l l l l l}
   \caption{DTMF Frequencies Table} \\
   \hline
      \textbf{Tag} &
      \textbf{DTMF} &
      \textbf{Kit\#} &
      \textbf{MIDI\#} &
      \textbf{Low} &
      \textbf{Low F} &
      \textbf{Actual F} &
      \textbf{High} &
      \textbf{High F} &
      \textbf{Actual F} \\
   \hline
   \endfirsthead

   1 &  1        & 5  & 53 & F3 &  697 &  705 &  F5     & 1209 &  1245  \\
   2 &  2        & 6  & 77 & F5 &  697 &  705 &  F5     & 1336 &  1337  \\
   3 &  3        & 7  & 89 & F6 &  697 &  698 &  F5     & 1477 &  1468  \\
   4 &  4        & 8  & 55 & G3 &  770 &  770 &  G5 -   & 1209 &  1236  \\
   5 &  5        & 9  & 79 & G5 &  770 &  776 &  G5 -   & 1336 &  1334  \\
   6 &  6        & 10 & 91 & G6 &  770 &  773 &  G5 -   & 1477 &  1462  \\
   7 &  7        & 11 & 57 & A3 &  852 &  855 &  G\#5 + & 1209 &  1245  \\
   8 &  8        & 12 & 81 & A5 &  852 &  868 &  G\#5 + & 1336 &  1327  \\
   9 &  9        & 13 & 93 & A6 &  852 &  866 &  G\#5 + & 1477 &  1480  \\
   * &  *        & 14 & 59 & B3 &  941 &  948 &  A\#5 + & 1209 &  1257  \\
   0 &  0        & 15 & 83 & B5 &  941 &  968 &  A\#5 + & 1336 &  1281  \\
  \# &  \#       & 16 & 95 & B6 &  941 &  950 &  A\#5 + & 1477 &  1480  \\
   A &  A        & -- & -- & A2 &  697 &  --- &  F5     & 1633 &  ---   \\
   B &  B        & -- & -- & B2 &  770 &  --- &  G5 -   & 1633 &  ---   \\
   C &  C        & -- & -- & C2 &  852 &  --- &  G\#5 + & 1633 &  ---   \\
   D &  D        & -- & -- & D2 &  941 &  --- &  A\#5 + & 1633 &  ---   \\
   b &  busy     & 2  & 71 & B4 &  480 &  472 &  B4 -   & 620  &  622   \\
   r &  ringback & 3  & 69 & A4 &  440 &  440 &  A4     & 480  &  480   \\
   d &  dialtone & 4  & 65 & F4 &  350 &  350 &  F4     & 440  &  440   \\
\end{longtable}

   This table is implemented in a \textsl{Yoshimi kit}.  Each note in the
   kit is created by making an ADDsynth instrument with two voices.  The
   lower voice generally corresponds to the note being play, with an offset,
   if needed, to achieve close to the proper frequency for the lower note of
   the DTMF tone.
   The second voice corresponds to the other note, and it is detune
   appropriately to achieve close to the proper frequency for the upper note
   of the DTMF tone.

   The following figure shows the kit dialog:

\begin{figure}[H]
   \centering 
   \includegraphics[scale=1.0]{demo/DTMF_kit_edit.png}
   \caption{Kit Edit Dialog for DTMF Kit}
   \label{fig:cookbook_instruments_dtmf_kit_edit}
\end{figure}

   To edit the kit, follow the steps below.  If desired, open the
   instrument file
   \index{files!DTMF kit}
   \texttt{yoshimi/banks/demo/DTMF\_Kit.xiz} to save some
   work.

   \begin{enumber}
      \item Open the kit editing window by clicking the \textbf{Edit}
         button in the bottom panel, and then clicking the
         \textbf{Kit Edit} button in the edit window.
      \item Make sure that the \textbf{Mode} is set to \textbf{Single}.
      \item Make sure that the \textbf{Drum mode} is enabled.
      \item For all 16 kit items, make sure that the \textbf{FX.r}
         selections are set to \textbf{OFF}.
      \item For kit items 2 to 16, enable the the \textbf{ADsynth}
         check-box.
      \item For kit items 2 to 16, perform the following procedure to set up
         the two frequencies correctly as per the table above:
         \begin{enumber}
            \item In the kit editor, click the \textbf{Name} field and enter
               the name of the DTMF tone item being edited.
            \item In the kit editor, set \textbf{Min.k} and \textbf{Max.k}
               to the value of the note that is less than or equal to the
               lower note of the item listed in the table.
            \item Click the ADDsynth \textbf{edit} button.
            \item Click on the \textbf{Show Voice Parameters} button.
               Note that it is \textbf{Current Voice 1}, and it should be
               enabled.
            \item Given the frequency for the note being edited, detune
               voice 1 to achieve the desired lower frequency.
            \item Change to voice 2, and enable it.
            \item Given the frequency for the note being edited, detune
               voice 1 to achieve the desired higher frequency.
         \end{enumber}
   \end{enumber}

   The "Actual F" values were verifed using 24-Hz resolution (at 1200 Hz)
   in the spectrum analyzer built into
   \index{Audacity}
   Audacity.
   Sometimes it took a few
   tries to get the best possible frequency.  We could list the detuning
   values in a table; for now, you can see the values we ended up using.

   The following figure shows the layout on the \textsl{Yoshimi} virtual
   keyboard:

\begin{figure}[H]
   \centering 
   \includegraphics[scale=1.0]{demo/DTMF-layout.png}
   \caption{DTMF Layout on the Keyboard}
   \label{fig:cookbook_instruments_DTMF_layout}
\end{figure}

\subsection{Piano}
\label{subsec:cookbook_instruments_piano}

   TODO.

\subsection{Leads}
\label{subsec:cookbook_instruments_leads}

   TODO.

\subsection{Guitar}
\label{subsec:cookbook_instruments_guitar}

   \textsl{Yoshimi} ships with some mediocre acoustic and steel guitar
   patches, but some amazing distortion guitars.  We decided to try our hand
   at a 12-string guitar.

\subsubsection{Guitar / 12-String}
\label{subsubsec:cookbook_instruments_guitar_12_string}

   A 12-string guitar has pairs of strings, with each member of a pair an
   octave apart in frequency, for all strings but one.  We've provided two
   versions of an attempt at a 12-string.

   \index{guitar!12-string}
   The first 12-string simulation is stored in
   \index{files!12-string}
   \texttt{yoshimi/banks/demo/Low\_Octave\_12-String\_Guitar\_Harms.xiz}.

   This patch provides one voice only, but the \textbf{Voice Oscillator}
   provides the fundamental and two harmonics.  In this oscillator,
   \textbf{H.md} is set to \textbf{Pow}.
   \textbf{Base F.} is set to \textbf{Pulse}.
   Voice 1 also enables the \textbf{Filter Params} to get a more acoustic
   sound.  Still sounds a bit harpsichordy.  Probably both strings need to
   be more complex.

   The second 12-string simulation is stored in
   \index{files!12-string}
   \texttt{yoshimi/banks/demo/Unison\_12-String\_Guitar\_Harms.xiz}.
   This version is similar to the previous 12-string, but, in voice 1,
   \textbf{Unison} is enabled, and vibrator and phase randomness are added.
   This version sounds significantly richer.

\subsection{Strings} (individual and ensemble)
\label{subsec:cookbook_instruments_strings}

   TODO.

\subsection{Bass}
\label{subsec:cookbook_instruments_bass}

   TODO.

\subsection{Saxophones}
\label{subsec:cookbook_instruments_saxophones}

   TODO.

%-------------------------------------------------------------------------------
% vim: ts=3 sw=3 et ft=tex
%-------------------------------------------------------------------------------
