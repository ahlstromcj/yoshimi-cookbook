Construction of "Before You Accuse Me" for ZynAddSubFx/Yoshimi
Chris Ahlstrom
2012-01-20 to 2016-04-24

This file describes the importing of one of my old Cakewalk transcriptions, a
rendering of Eric Clapton and Robert Cray from a transcription that someone
gave to me to try out.  It was originally transcribed to fit the Yahama
PSS-790, as I recall (it was years and years ago!)

First, let us run it as is through timidity:

$ timidity b4uacuse.mid 
Format: 1  Tracks: 14  Divisions: 120
Track name: PSS-790 Patchin
Track name: Guitar 1 (E.C.)
Track name: Guitar 2 (R.C.)
Track name: Vocal
Track name: Rhythm (Chords)
Track name: Bass Guitar
Track name: Drums
Track name: Chris Ahlstrom
Track name: (GEnie: KICKAHA
Track name: "Before You
Track name: Accuse Me" by
Track name: Eric Clapton &
Track name: Robert Cray
No instrument mapped to tone bank 0, program 12 -
	 this instrument will not be heard
No instrument mapped to tone bank 0, program 87 -
	 this instrument will not be heard

Our /etc/timidity/timidity.cfg file specifies the /etc/timidity/freepats.cfg
file.  In this file, we see that bank 0 does not define the three patch numbers
that are noted as missing above and below:  12, 62, and 87.  Patch 12 on the
PSS-790 is "Marimba", but is mapped to GM "Jazz Guitar" ("Elec. Guitar
(jazz)").  In Timidity freepats, this is patch 26.  Patch 0 is mapped to
patch 62, which is "Synth Brass 1" in GM; the closest in Timidity freepats is
patch 61 "Brass Section".  Patch 87 on the PSS-790 is "Lead 8 (bass+lead)"
which gets mapped to "Flugelhorn" ("English Horn").

Let us use midicvtpp to convert it to good (we hope) GM format:

   $ midicvtpp --m2m GM_PSS-790_Multi.ini -i b4uacuse.mid -o b4uacuse-gm-1.mid

or, for more information:

   $ midicvtpp --m2m GM_PSS-790_Multi.ini
         --summarize b4uacuse.mid b4uacuse-gm-1.mid 2> summary.txt

The command creates a file that has only one "error" message and
plays pretty well in Timidity:

	No instrument mapped to tone bank 0, program 62 -
       this instrument will not be heard

Again, note that patch 62 is a "Synth Brass 1" patch.

We cannot tell what the target voices of the PSS-790 were, and what they were
converted to.  That sounds like a feature to add to midicvtpp!  Done, in version
0.4.0!  We can go forward with the GM MIDI bank we have created for Yoshimi.
Take a look at the file summary.txt.  Used in the patch descriptions above.

The next step is to see how these patches map to our preliminary Yoshimi GM
bank.  We have three ways to go for patching:

   1. Keep the program-change track(s) and use them to select instruments.
   2. Move each program-change to the appropriate track.
   3. Remove all program-change events and rely on a Yoshimi state file
      to set up.

The disadvantage of keeping the program changes:

   1. They are currently spread out in three different tracks, as can be seen
      by opening the b4uacuse-gm-1.mid file in Sequencer64 and viewing the
      "PSS-790 Patch", "Chris Ahlstro", and "(GEnie: KICKA" tracks using the
      Event Editor.
   2. They make it difficult to remix the song for playback on various
      synthesizers other than Yoshimi.
   3. At least in Yoshimi, it becomes more difficult to change the instruments
      used.
   4. They take away a chance to learn how Yoshimi state works.

On the other hand, it will be interesting to add program changes to the tune
and see how Yoshimi handles it these days.  Later.

So let us take b4uacuse-gm-1.mid, trim out the patch tracks and empty tracks,
recreate the layout of the song editor, and save it as
b4uacuse-gm-patchless.midi.  Here are the tracks, and their putative GM
instruments as numbered in our GM bank:

Track 0: Guitar 1 (E.C.)         #26 Acou. Guitar (steel)
Track 1: Guitar 2 (R.C.)         #27 Elec. Guitar (jazz)
Track 2: Bass Guitar             #34 Elec. Bass (finger)
Track 3: Drums                   Drums
Track 4: Vocal                   #70 English Horn
Track 5: Rhythm (Chords)         #4 Honky-tonk Piano

See summary.txt to see what conversions were made by midicvt.
We go to Yoshimi / Menu / Patch Sets / Show Patch Banks... and look at the
banks.  We select "116. gm-basic".  This bank has passable (in most cases)
equivalents to GM instruments, plus a drum kit at program number 129 (an
extended program number).

We will set the channels to "track + 1", except for drums, which go to channel 10.
Channels are counted from 1.  We enable each Yoshimi Part.  We note the name (in
quotes) of the corresponding Yoshimi patch.

Yoshimi parts from the gm-basic bank (116. gm-basic):

Track 0, Ch.  1: Guitar 1 (E.C.) #26 Acoustic Guitar (steel) ("Clean Guitar 1")
Track 1, Ch.  2: Guitar 2 (R.C.) #27 Electric Guitar (jazz) ("Electric Guitar")
Track 2, Ch.  3: Bass Guitar     #34 Electric Bass (finger) ("Electric bass 1")
Track 3, Ch. 10: Drums           #129 Drum Kit ("Natural Drum Kit from DS 2")
Track 4, Ch.  5: Vocal           #70 English Horn ("Analog Brass 2")
Track 5, Ch.  6: Rhythm (Chords) #4 Honky-tonk Piano ("Synth Piano 3 fat")

The bank must be installed in ~/.config/yoshimi-cookbook/banks.

After setting up each Track/Part/Channel, we played the tune, and adjusted the
volume of some of the parts while playing it through buss 5 (where Yoshimi sets
up on our system) via the command

   $ sequencer64 --bus 5 b4uacuse-gm-patchless.midi
   
We then saved the entire state of Yoshimi to
~/.config/yoshimi/yoshimi-b4uacuse-gm.state via Menu / State / Save ....  We
reload this file via

   $ yoshimi -a -A --state=yoshimi-b4uacuse-gm.state
   
to verify that it still works.  We ended up switching to JACK playback for
recording the audio:

   $ sequencer64 -J b4uacuse-gm-patchless.midi
   $ yoshimi -j -J --state=yoshimi-b4uacuse-gm.state

and avconv (ffmpeg) for converting it to an MP3 file that one can listen to
without loading up all this software.

# vim: sw=4 ts=4 wm=4 et ft=sh
